<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>agrotech lab - 22&nbsp; Deep Sleep</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../tutorials/esp_now.html" rel="next">
<link href="../tutorials/MQTT.html" rel="prev">
<link href="..//archive/images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/iconify-1.0.0-beta.2/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../custom.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/pulse-sensors.html"><strong>Sensors and comm</strong></a></li><li class="breadcrumb-item"><a href="../tutorials/deep_sleep.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Deep Sleep</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../archive/images/site-logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">agrotech lab</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://yairmau.com/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-fill"></i></a>
    <a href="../sources.html" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-bookmark-fill"></i></a>
    <a href="../things-to-remember.html" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-asterisk"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text"><strong>Start here</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../arduino-intro-and-links.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Arduino intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/arduino_IDE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Arduino IDE</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/install_firebeetle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Install FireBeetle (ESP32)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text"><strong>Basics</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/breadboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Breadboard</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/basic-electronics-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basic Electronics Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/firebeetle_documentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">FireBeetle 2 ESP32-E</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/libraries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Libraries</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text"><strong>Lectures</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/first-programs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">First programs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/electronics-class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Electronics Class</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/electronics-class-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Electronics Class 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/digital-read-write.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Reading digital and analog</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/digital-sensors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Digital sensors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/cloud-connectivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Cloud connectivity</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text"><strong>Running simple programs</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/merging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Code Merging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/RGB.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">RGB LED</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text"><strong>Electronics</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/relay.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Switches, Relays, Transistors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/soldering-and-wires.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Soldering and Wires</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/electronics-class-old.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Electronics Class Old</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text"><strong>Sensors and comm</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/pulse-sensors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Pulse sensors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/MQTT.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">MQTT</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/deep_sleep.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Deep Sleep</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/esp_now.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">ESP-NOW</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/OLED.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">OLED screen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python-matlab-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Basic Data Analysis with Python and Matlab</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/API-thingspeak-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">API to download Thingspeak data with Python</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text"><strong>Agro stuff</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/water-and-energy-balances.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Water and Energy Balances</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/psychrometric-chart-and-evaporative-cooling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Psychrometric Chart and Evaporative Cooling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text"><strong>Assignments</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Assignment 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Assignment 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text"><strong>Resources</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title"> Resources</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
 <span class="menu-text"><strong>Projects</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title"> Past Final Projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/borrowing-equipment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Borrowing equipment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/final-project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Final Project</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Example projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/greenhouse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">The Smart Greenhouse</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#key-features-of-deep-sleep" id="toc-key-features-of-deep-sleep" class="nav-link active" data-scroll-target="#key-features-of-deep-sleep"><span class="header-section-number">22.1</span> Key Features of Deep Sleep</a></li>
  <li><a href="#deep-sleep-code" id="toc-deep-sleep-code" class="nav-link" data-scroll-target="#deep-sleep-code"><span class="header-section-number">22.2</span> Deep Sleep code</a></li>
  <li><a href="#deep-sleep-wake-with-touch" id="toc-deep-sleep-wake-with-touch" class="nav-link" data-scroll-target="#deep-sleep-wake-with-touch"><span class="header-section-number">22.3</span> Deep Sleep wake with touch</a></li>
  <li><a href="#save-values-between-sleeps" id="toc-save-values-between-sleeps" class="nav-link" data-scroll-target="#save-values-between-sleeps"><span class="header-section-number">22.4</span> Save values between sleeps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<script src="https://code.iconify.design/iconify-icon/1.0.1/iconify-icon.min.js"></script>

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/pulse-sensors.html"><strong>Sensors and comm</strong></a></li><li class="breadcrumb-item"><a href="../tutorials/deep_sleep.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Deep Sleep</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Deep Sleep</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- ---
title: ""
echo: false
jupyter: python3
section-divs: false
--- -->
<p>Deep sleep is a power-saving mode on the ESP32 microcontroller that allows it to significantly reduce its power consumption by shutting down most of its components and functionalities. This mode is particularly useful for battery-powered applications where conserving energy is crucial.</p>
<section id="key-features-of-deep-sleep" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="key-features-of-deep-sleep"><span class="header-section-number">22.1</span> Key Features of Deep Sleep</h2>
<ol type="1">
<li><strong>Low Power Consumption:</strong><br>
In deep sleep mode, the ESP32 consumes only a few microamps of current, drastically reducing power usage compared to its normal operating modes.</li>
<li><strong>Preservation of Data:</strong><br>
The ESP32 can save the state of its peripherals and the values of certain variables in RTC (Real-Time Clock) memory, which is retained during deep sleep. This allows the microcontroller to resume tasks efficiently upon waking up.</li>
<li><strong>Wake-Up Sources:</strong><br>
The ESP32 can be awakened from deep sleep by various events:
<ul>
<li>Timer: The internal RTC can be programmed to wake the device after a specified time interval.</li>
<li>External Pin: A change in the state of a designated GPIO pin can trigger a wake-up.</li>
<li>Touch Sensor: Touch pad sensors can be used to wake up the device.</li>
<li>ULP Coprocessor: The Ultra-Low-Power (ULP) coprocessor can run while the main CPU is in deep sleep and trigger a wake-up event based on sensor readings or other conditions.</li>
</ul></li>
<li><strong>Application Examples:</strong>
<ul>
<li>Battery-Powered Sensors: Environmental sensors that need to periodically send data can spend most of their time in deep sleep, waking up only to take measurements and transmit data.</li>
<li>IoT Devices: Devices that need to conserve power, such as remote weather stations or smart home devices, can use deep sleep to extend battery life.</li>
</ul></li>
</ol>
</section>
<section id="deep-sleep-code" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="deep-sleep-code"><span class="header-section-number">22.2</span> Deep Sleep code</h2>
<button class="btn btn-outline-dark  rounded" type="button" data-bs-toggle="collapse" data-bs-target="#deep_sleepino" aria-expanded="false" aria-controls="deep_sleepino">
    <i class="bi bi-toggles"></i> Toggle code
    </button>
     <a class="btn btn-outline-dark rounded" ,="" href="../archive/code/deep_sleep.ino" download="" target="_blank" rel="noopener noreferrer">
        <i class="bi bi-download"></i> Download code
    </a>

            <div class="collapse" id="deep_sleepino">
            <div class="card card-body border-0">
        
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource c number-lines code-with-copy"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1"></a><span class="pp">#define uS_TO_S_FACTOR </span><span class="dv">1000000</span><span class="bu">ULL</span><span class="pp">  </span><span class="co">/* Conversion factor for micro seconds to seconds */</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="pp">#define TIME_TO_SLEEP  </span><span class="dv">10</span><span class="pp">        </span><span class="co">/* Time ESP32 will go to sleep (in seconds) */</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="dt">void</span> setup<span class="op">(){</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Good morning!"</span><span class="op">);</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>  delay<span class="op">(</span><span class="dv">2000</span><span class="op">);</span> <span class="co">//Take some time to open up the Serial Monitor</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="co">// turn on LED</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"turn on LED"</span><span class="op">);</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  pinMode<span class="op">(</span>LED_BUILTIN<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>  digitalWrite<span class="op">(</span>LED_BUILTIN<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>  delay<span class="op">(</span><span class="dv">2000</span><span class="op">);</span> <span class="co">//Take some time to open up the Serial Monitor</span></span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="co">/*</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">  First we configure the wake up source</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">  We set our ESP32 to wake up every TIME_TO_SLEEP seconds</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">  */</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>  esp_sleep_enable_timer_wakeup<span class="op">(</span>TIME_TO_SLEEP <span class="op">*</span> uS_TO_S_FACTOR<span class="op">);</span></span>
<span id="cb1-21"><a href="#cb1-21"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Setup ESP32 to sleep for every "</span> <span class="op">+</span> String<span class="op">(</span>TIME_TO_SLEEP<span class="op">)</span> <span class="op">+</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="st">" Seconds"</span><span class="op">);</span></span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>  </span>
<span id="cb1-25"><a href="#cb1-25"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Going to sleep now"</span><span class="op">);</span></span>
<span id="cb1-26"><a href="#cb1-26"></a>  Serial<span class="op">.</span>flush<span class="op">();</span> </span>
<span id="cb1-27"><a href="#cb1-27"></a>  esp_deep_sleep_start<span class="op">();</span></span>
<span id="cb1-28"><a href="#cb1-28"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"This will never be printed"</span><span class="op">);</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="op">}</span></span>
<span id="cb1-30"><a href="#cb1-30"></a></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="dt">void</span> loop<span class="op">(){</span></span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="co">//This is not going to be called</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

            </div>
            </div>
            
</section>
<section id="deep-sleep-wake-with-touch" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="deep-sleep-wake-with-touch"><span class="header-section-number">22.3</span> Deep Sleep wake with touch</h2>
<p>Adapted from <a href="https://randomnerdtutorials.com/esp32-touch-wake-up-deep-sleep/">here</a>.</p>
<button class="btn btn-outline-dark  rounded" type="button" data-bs-toggle="collapse" data-bs-target="#touch_wakeupino" aria-expanded="false" aria-controls="touch_wakeupino">
    <i class="bi bi-toggles"></i> Toggle code
    </button>
     <a class="btn btn-outline-dark rounded" ,="" href="../archive/code/touch_wakeup.ino" download="" target="_blank" rel="noopener noreferrer">
        <i class="bi bi-download"></i> Download code
    </a>

            <div class="collapse" id="touch_wakeupino">
            <div class="card card-body border-0">
        
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource c number-lines code-with-copy"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">/*</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">Deep Sleep with Touch Wake Up</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">=====================================</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">This code displays how to use deep sleep with</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">a touch as a wake up source and how to store data in</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">RTC memory to use it over reboots</span></span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">ESP32 can have multiple touch pads enabled as wakeup source</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">ESP32-S2 and ESP32-S3 supports only 1 touch pad as wakeup source enabled</span></span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">This code is under Public Domain License.</span></span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">Author:</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">Pranav Cherukupalli &lt;cherukupallip@gmail.com&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">*/</span></span>
<span id="cb2-16"><a href="#cb2-16"></a></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="pp">#if CONFIG_IDF_TARGET_ESP32</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="pp">#define THRESHOLD </span><span class="dv">40</span><span class="pp">   </span><span class="co">/* Greater the value, more the sensitivity */</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="pp">#else                  </span><span class="co">//ESP32-S2 and ESP32-S3 + default for other chips (to be adjusted) */</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="pp">#define THRESHOLD </span><span class="dv">5000</span><span class="pp"> </span><span class="co">/* Lower the value, more the sensitivity */</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="pp">#endif</span></span>
<span id="cb2-22"><a href="#cb2-22"></a></span>
<span id="cb2-23"><a href="#cb2-23"></a>RTC_DATA_ATTR <span class="dt">int</span> bootCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>touch_pad_t touchPin<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">/*</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">Method to print the reason by which ESP32</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">has been awaken from sleep</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">*/</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="dt">void</span> print_wakeup_reason<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>  esp_sleep_wakeup_cause_t wakeup_reason<span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31"></a></span>
<span id="cb2-32"><a href="#cb2-32"></a>  wakeup_reason <span class="op">=</span> esp_sleep_get_wakeup_cause<span class="op">();</span></span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a>  <span class="cf">switch</span> <span class="op">(</span>wakeup_reason<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>    <span class="cf">case</span> ESP_SLEEP_WAKEUP_EXT0<span class="op">:</span>     Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Wakeup caused by external signal using RTC_IO"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-36"><a href="#cb2-36"></a>    <span class="cf">case</span> ESP_SLEEP_WAKEUP_EXT1<span class="op">:</span>     Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Wakeup caused by external signal using RTC_CNTL"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37"></a>    <span class="cf">case</span> ESP_SLEEP_WAKEUP_TIMER<span class="op">:</span>    Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Wakeup caused by timer"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-38"><a href="#cb2-38"></a>    <span class="cf">case</span> ESP_SLEEP_WAKEUP_TOUCHPAD<span class="op">:</span> Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Wakeup caused by touchpad"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-39"><a href="#cb2-39"></a>    <span class="cf">case</span> ESP_SLEEP_WAKEUP_ULP<span class="op">:</span>      Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Wakeup caused by ULP program"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-40"><a href="#cb2-40"></a>    <span class="cf">default</span><span class="op">:</span>                        Serial<span class="op">.</span>printf<span class="op">(</span><span class="st">"Wakeup was not caused by deep sleep: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> wakeup_reason<span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-41"><a href="#cb2-41"></a>  <span class="op">}</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="op">}</span></span>
<span id="cb2-43"><a href="#cb2-43"></a></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">/*</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="co">Method to print the touchpad by which ESP32</span></span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="co">has been awaken from sleep</span></span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="co">*/</span></span>
<span id="cb2-48"><a href="#cb2-48"></a><span class="dt">void</span> print_wakeup_touchpad<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-49"><a href="#cb2-49"></a>  touchPin <span class="op">=</span> esp_sleep_get_touchpad_wakeup_status<span class="op">();</span></span>
<span id="cb2-50"><a href="#cb2-50"></a></span>
<span id="cb2-51"><a href="#cb2-51"></a><span class="pp">#if CONFIG_IDF_TARGET_ESP32</span></span>
<span id="cb2-52"><a href="#cb2-52"></a>  <span class="cf">switch</span> <span class="op">(</span>touchPin<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-53"><a href="#cb2-53"></a>    <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 4"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-54"><a href="#cb2-54"></a>    <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 0"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55"></a>    <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 2"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-56"><a href="#cb2-56"></a>    <span class="cf">case</span> <span class="dv">3</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 15"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-57"><a href="#cb2-57"></a>    <span class="cf">case</span> <span class="dv">4</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 13"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-58"><a href="#cb2-58"></a>    <span class="cf">case</span> <span class="dv">5</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 12"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-59"><a href="#cb2-59"></a>    <span class="cf">case</span> <span class="dv">6</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 14"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-60"><a href="#cb2-60"></a>    <span class="cf">case</span> <span class="dv">7</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 27"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-61"><a href="#cb2-61"></a>    <span class="cf">case</span> <span class="dv">8</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 33"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-62"><a href="#cb2-62"></a>    <span class="cf">case</span> <span class="dv">9</span><span class="op">:</span>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Touch detected on GPIO 32"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-63"><a href="#cb2-63"></a>    <span class="cf">default</span><span class="op">:</span> Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Wakeup not by touchpad"</span><span class="op">);</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-64"><a href="#cb2-64"></a>  <span class="op">}</span></span>
<span id="cb2-65"><a href="#cb2-65"></a><span class="pp">#else</span></span>
<span id="cb2-66"><a href="#cb2-66"></a>  <span class="cf">if</span> <span class="op">(</span>touchPin <span class="op">&lt;</span> TOUCH_PAD_MAX<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-67"><a href="#cb2-67"></a>    Serial<span class="op">.</span>printf<span class="op">(</span><span class="st">"Touch detected on GPIO </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> touchPin<span class="op">);</span></span>
<span id="cb2-68"><a href="#cb2-68"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb2-69"><a href="#cb2-69"></a>    Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Wakeup not by touchpad"</span><span class="op">);</span></span>
<span id="cb2-70"><a href="#cb2-70"></a>  <span class="op">}</span></span>
<span id="cb2-71"><a href="#cb2-71"></a><span class="pp">#endif</span></span>
<span id="cb2-72"><a href="#cb2-72"></a><span class="op">}</span></span>
<span id="cb2-73"><a href="#cb2-73"></a></span>
<span id="cb2-74"><a href="#cb2-74"></a><span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-75"><a href="#cb2-75"></a>  Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb2-76"><a href="#cb2-76"></a>  delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span>  <span class="co">//Take some time to open up the Serial Monitor</span></span>
<span id="cb2-77"><a href="#cb2-77"></a></span>
<span id="cb2-78"><a href="#cb2-78"></a>  <span class="co">//Increment boot number and print it every reboot</span></span>
<span id="cb2-79"><a href="#cb2-79"></a>  <span class="op">++</span>bootCount<span class="op">;</span></span>
<span id="cb2-80"><a href="#cb2-80"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Boot number: "</span> <span class="op">+</span> String<span class="op">(</span>bootCount<span class="op">));</span></span>
<span id="cb2-81"><a href="#cb2-81"></a></span>
<span id="cb2-82"><a href="#cb2-82"></a>  <span class="co">//Print the wakeup reason for ESP32 and touchpad too</span></span>
<span id="cb2-83"><a href="#cb2-83"></a>  print_wakeup_reason<span class="op">();</span></span>
<span id="cb2-84"><a href="#cb2-84"></a>  print_wakeup_touchpad<span class="op">();</span></span>
<span id="cb2-85"><a href="#cb2-85"></a></span>
<span id="cb2-86"><a href="#cb2-86"></a><span class="pp">#if CONFIG_IDF_TARGET_ESP32</span></span>
<span id="cb2-87"><a href="#cb2-87"></a>  <span class="co">//Setup sleep wakeup on Touch Pad 3 + 7 (GPIO15 + GPIO 27)</span></span>
<span id="cb2-88"><a href="#cb2-88"></a>  touchSleepWakeUpEnable<span class="op">(</span>T3<span class="op">,</span> THRESHOLD<span class="op">);</span></span>
<span id="cb2-89"><a href="#cb2-89"></a>  touchSleepWakeUpEnable<span class="op">(</span>T7<span class="op">,</span> THRESHOLD<span class="op">);</span></span>
<span id="cb2-90"><a href="#cb2-90"></a></span>
<span id="cb2-91"><a href="#cb2-91"></a><span class="pp">#else  </span><span class="co">//ESP32-S2 + ESP32-S3</span></span>
<span id="cb2-92"><a href="#cb2-92"></a>  <span class="co">//Setup sleep wakeup on Touch Pad 3 (GPIO3)</span></span>
<span id="cb2-93"><a href="#cb2-93"></a>  touchSleepWakeUpEnable<span class="op">(</span>T3<span class="op">,</span> THRESHOLD<span class="op">);</span></span>
<span id="cb2-94"><a href="#cb2-94"></a></span>
<span id="cb2-95"><a href="#cb2-95"></a><span class="pp">#endif</span></span>
<span id="cb2-96"><a href="#cb2-96"></a></span>
<span id="cb2-97"><a href="#cb2-97"></a>  <span class="co">//Go to sleep now</span></span>
<span id="cb2-98"><a href="#cb2-98"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Going to sleep now"</span><span class="op">);</span></span>
<span id="cb2-99"><a href="#cb2-99"></a>  esp_deep_sleep_start<span class="op">();</span></span>
<span id="cb2-100"><a href="#cb2-100"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"This will never be printed"</span><span class="op">);</span></span>
<span id="cb2-101"><a href="#cb2-101"></a><span class="op">}</span></span>
<span id="cb2-102"><a href="#cb2-102"></a></span>
<span id="cb2-103"><a href="#cb2-103"></a><span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-104"><a href="#cb2-104"></a>  <span class="co">//This will never be reached</span></span>
<span id="cb2-105"><a href="#cb2-105"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

            </div>
            </div>
            
</section>
<section id="save-values-between-sleeps" class="level2" data-number="22.4">
<h2 data-number="22.4" class="anchored" data-anchor-id="save-values-between-sleeps"><span class="header-section-number">22.4</span> Save values between sleeps</h2>
<p>Recommended tutorial <a href="https://randomnerdtutorials.com/esp32-save-data-permanently-preferences/">here</a>.</p>
<button class="btn btn-outline-dark  rounded" type="button" data-bs-toggle="collapse" data-bs-target="#save_valuesino" aria-expanded="false" aria-controls="save_valuesino">
    <i class="bi bi-toggles"></i> Toggle code
    </button>
     <a class="btn btn-outline-dark rounded" ,="" href="../archive/code/save_values.ino" download="" target="_blank" rel="noopener noreferrer">
        <i class="bi bi-download"></i> Download code
    </a>

            <div class="collapse" id="save_valuesino">
            <div class="card card-body border-0">
        
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource c number-lines code-with-copy"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">/*</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">Good tutorial</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">https://randomnerdtutorials.com/esp32-save-data-permanently-preferences/</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">*/</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="pp">#include </span><span class="im">&lt;Preferences.h&gt;</span><span class="pp"> </span><span class="co">// Include the Preferences library</span></span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="pp">#define uS_TO_S_FACTOR </span><span class="dv">1000000</span><span class="bu">ULL</span><span class="pp">  </span><span class="co">/* Conversion factor for microseconds to seconds */</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="pp">#define TIME_TO_SLEEP  </span><span class="dv">10</span><span class="pp">          </span><span class="co">/* Time ESP32 will go to sleep (in seconds) */</span></span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a>Preferences preferences<span class="op">;</span>           <span class="co">// Create a Preferences object</span></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>  Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Good morning!"</span><span class="op">);</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>  delay<span class="op">(</span><span class="dv">100</span><span class="op">);</span> <span class="co">// Take some time to open up the Serial Monitor</span></span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a>  <span class="co">// Turn on LED</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Turn on LED"</span><span class="op">);</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>  pinMode<span class="op">(</span>LED_BUILTIN<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>  digitalWrite<span class="op">(</span>LED_BUILTIN<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  delay<span class="op">(</span><span class="dv">2000</span><span class="op">);</span></span>
<span id="cb3-22"><a href="#cb3-22"></a></span>
<span id="cb3-23"><a href="#cb3-23"></a>  <span class="co">// Open Preferences in RW mode</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>  preferences<span class="op">.</span>begin<span class="op">(</span><span class="st">"my-app"</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span> <span class="co">// "my-app" is the namespace, false = read/write mode</span></span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a>  <span class="co">// Retrieve stored values</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>  <span class="dt">int</span> storedInt <span class="op">=</span> preferences<span class="op">.</span>getInt<span class="op">(</span><span class="st">"myInt"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span>      <span class="co">// Default value is 0 if not set</span></span>
<span id="cb3-28"><a href="#cb3-28"></a>  <span class="dt">float</span> storedFloat <span class="op">=</span> preferences<span class="op">.</span>getFloat<span class="op">(</span><span class="st">"myFloat"</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span> <span class="co">// Default is 0.0</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>  String storedString <span class="op">=</span> preferences<span class="op">.</span>getString<span class="op">(</span><span class="st">"myString"</span><span class="op">,</span> <span class="st">"Default"</span><span class="op">);</span></span>
<span id="cb3-30"><a href="#cb3-30"></a></span>
<span id="cb3-31"><a href="#cb3-31"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Retrieved values from flash:"</span><span class="op">);</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Int: "</span> <span class="op">+</span> String<span class="op">(</span>storedInt<span class="op">));</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Float: "</span> <span class="op">+</span> String<span class="op">(</span>storedFloat<span class="op">));</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"String: "</span> <span class="op">+</span> storedString<span class="op">);</span></span>
<span id="cb3-35"><a href="#cb3-35"></a></span>
<span id="cb3-36"><a href="#cb3-36"></a>  <span class="co">// Increment and store new values</span></span>
<span id="cb3-37"><a href="#cb3-37"></a>  storedInt<span class="op">++;</span></span>
<span id="cb3-38"><a href="#cb3-38"></a>  storedFloat <span class="op">+=</span> <span class="fl">1.5</span><span class="op">;</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>  storedString <span class="op">=</span> <span class="st">"Wake #"</span> <span class="op">+</span> String<span class="op">(</span>storedInt<span class="op">);</span></span>
<span id="cb3-40"><a href="#cb3-40"></a></span>
<span id="cb3-41"><a href="#cb3-41"></a>  preferences<span class="op">.</span>putInt<span class="op">(</span><span class="st">"myInt"</span><span class="op">,</span> storedInt<span class="op">);</span></span>
<span id="cb3-42"><a href="#cb3-42"></a>  preferences<span class="op">.</span>putFloat<span class="op">(</span><span class="st">"myFloat"</span><span class="op">,</span> storedFloat<span class="op">);</span></span>
<span id="cb3-43"><a href="#cb3-43"></a>  preferences<span class="op">.</span>putString<span class="op">(</span><span class="st">"myString"</span><span class="op">,</span> storedString<span class="op">);</span></span>
<span id="cb3-44"><a href="#cb3-44"></a></span>
<span id="cb3-45"><a href="#cb3-45"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Stored updated values in flash:"</span><span class="op">);</span></span>
<span id="cb3-46"><a href="#cb3-46"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Int: "</span> <span class="op">+</span> String<span class="op">(</span>storedInt<span class="op">));</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Float: "</span> <span class="op">+</span> String<span class="op">(</span>storedFloat<span class="op">));</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"String: "</span> <span class="op">+</span> storedString<span class="op">);</span></span>
<span id="cb3-49"><a href="#cb3-49"></a></span>
<span id="cb3-50"><a href="#cb3-50"></a>  <span class="co">// Close Preferences</span></span>
<span id="cb3-51"><a href="#cb3-51"></a>  preferences<span class="op">.</span>end<span class="op">();</span></span>
<span id="cb3-52"><a href="#cb3-52"></a></span>
<span id="cb3-53"><a href="#cb3-53"></a>  <span class="co">// Configure the wake-up source</span></span>
<span id="cb3-54"><a href="#cb3-54"></a>  esp_sleep_enable_timer_wakeup<span class="op">(</span>TIME_TO_SLEEP <span class="op">*</span> uS_TO_S_FACTOR<span class="op">);</span></span>
<span id="cb3-55"><a href="#cb3-55"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Setup ESP32 to sleep for every "</span> <span class="op">+</span> String<span class="op">(</span>TIME_TO_SLEEP<span class="op">)</span> <span class="op">+</span> <span class="st">" seconds"</span><span class="op">);</span></span>
<span id="cb3-56"><a href="#cb3-56"></a></span>
<span id="cb3-57"><a href="#cb3-57"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Going to sleep now"</span><span class="op">);</span></span>
<span id="cb3-58"><a href="#cb3-58"></a>  Serial<span class="op">.</span>flush<span class="op">();</span></span>
<span id="cb3-59"><a href="#cb3-59"></a>  esp_deep_sleep_start<span class="op">();</span></span>
<span id="cb3-60"><a href="#cb3-60"></a></span>
<span id="cb3-61"><a href="#cb3-61"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"This will never be printed"</span><span class="op">);</span></span>
<span id="cb3-62"><a href="#cb3-62"></a><span class="op">}</span></span>
<span id="cb3-63"><a href="#cb3-63"></a></span>
<span id="cb3-64"><a href="#cb3-64"></a><span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-65"><a href="#cb3-65"></a>  <span class="co">// This is not going to be called</span></span>
<span id="cb3-66"><a href="#cb3-66"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

            </div>
            </div>
            


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../tutorials/MQTT.html" class="pagination-link" aria-label="MQTT">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">MQTT</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../tutorials/esp_now.html" class="pagination-link" aria-label="ESP-NOW">
        <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">ESP-NOW</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>