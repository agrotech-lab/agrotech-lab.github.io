{
  "hash": "a3a12a6c7a9360a4b8fd4d97fe382c2a",
  "result": {
    "markdown": "---\ntitle: Pulse sensors\ndate: '2022-05-03'\ncategories:\n  - arduino\necho: false\nexecute:\n  freeze: auto\n---\n\n<!-- ---\ntitle: \"\"\necho: false\njupyter: python3\nsection-divs: false\n--- -->\n\n\n\n## Square wave\n\n![](https://i.stack.imgur.com/rTpKu.png)\n\n### Pulse counter\n\n```{=html}\n<button class=\"btn btn-outline-dark  rounded\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#pulse_counter.ino\" aria-expanded=\"false\" aria-controls=\"pulse_counter.ino\">\n    <i class=\"bi bi-toggles\"></i> Toggle code\n    </button>\n     <a class=\"btn btn-outline-dark rounded\", href=\"/archive/code/pulse_counter.ino\" target=\"_blank\" rel=\"noopener noreferrer\">\n        <i class=\"bi bi-download\"></i> Download code\n    </a>\n```\n```{=html}\n\n            <div class=\"collapse\" id=\"pulse_counter.ino\">\n            <div class=\"card card-body border-0\">\n        \n```\n```{.c code-line-numbers=\"1\"}\nint sensorPin = A4;\nvolatile long pulse_count;\n\nfloat volume;\n\nvoid setup() {\n  pinMode(sensorPin, INPUT);\n  Serial.begin(115200);\n  attachInterrupt(digitalPinToInterrupt(sensorPin), increase, RISING);\n}\n\nvoid loop() {\n  Serial.print(pulse_count);\n  Serial.println(\" counts\");\n  delay(50);\n}\n\nICACHE_RAM_ATTR void increase() {\n  pulse_count++;\n}\n\n```\n\n```{=html}\n\n            </div>\n            </div>\n            \n```\n\n\n### Calculate frequency from counts\n\n```{=html}\n<button class=\"btn btn-outline-dark  rounded\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#pulse_frequency.ino\" aria-expanded=\"false\" aria-controls=\"pulse_frequency.ino\">\n    <i class=\"bi bi-toggles\"></i> Toggle code\n    </button>\n     <a class=\"btn btn-outline-dark rounded\", href=\"/archive/code/pulse_frequency.ino\" target=\"_blank\" rel=\"noopener noreferrer\">\n        <i class=\"bi bi-download\"></i> Download code\n    </a>\n```\n```{=html}\n\n            <div class=\"collapse\" id=\"pulse_frequency.ino\">\n            <div class=\"card card-body border-0\">\n        \n```\n```{.c code-line-numbers=\"1\"}\nint sensorPin = A4;\nvolatile long pulse_count;\nunsigned long last_print_time;\nlong total_pulse_count = 0;\nfloat volume;\n\nvoid setup() {\n  pinMode(sensorPin, INPUT);\n  Serial.begin(115200);\n  attachInterrupt(digitalPinToInterrupt(sensorPin), increase, RISING);\n  last_print_time = millis();\n}\n\nvoid loop() {\n  unsigned long current_time = millis();\n  if (current_time - last_print_time >= 1000) { // print every second\n    float frequency = (float)pulse_count / ((current_time - last_print_time) / 1000.0);\n    total_pulse_count += pulse_count; // update total pulse count\n    Serial.print(total_pulse_count);\n    Serial.print(\" total counts, \");\n    Serial.print(frequency);\n    Serial.println(\" counts per second\");\n    pulse_count = 0; // reset pulse count\n    last_print_time = current_time;\n  }\n}\n\nICACHE_RAM_ATTR void increase() {\n  pulse_count++;\n}\n\n```\n\n```{=html}\n\n            </div>\n            </div>\n            \n```\n\n\n----\n\n<script type=\"text/javascript\" src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js\"></script>\n\n<script type=\"text/javascript\">\nfunction toggle_icon_show_content(Show_Hide_Id,Icon_Id) {\n    $(\"#\"+Icon_Id).toggleClass('fa-plus-square fa-minus-square')\n    $(\"#\"+Show_Hide_Id).slideToggle('slow');\n}\n</script>\n\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js\"></script>\n\n",
    "supporting": [
      "pulse-sensors_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}